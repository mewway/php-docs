# 接口开发规范

## API开发的准则

### 请求的格式和响应的格式

在常用的请求响应格式中, 主要包含以下几种:

-   Snake 小写下划线的风格, 形如: `i_love_tomato`
-   MixedCaps 驼峰风格, 其中包括大驼峰, 形如: `ILoveTomato`, 小驼峰, 形如:`iLoveTomato`

请求的入参数及路由的命名 **必须** 严格按照 **小写数字下划线** 的风格命名, 接口的响应也 **必须** 按照 **小写数字下划线** 的风格响应


> 路由的命名中下划线使用？： 1. 中划线 （seo友好） 2. 下划线（历史用法，沿用）

### 原则
- 接口 *应该* 预留版本的设计
  1. 默认版本 `v1` *应该* 默认不在路由中体现 `/api/material/:id`
  2. V2版本： `/api/v2/material/:id` 对应控制器中的方法 *应该* 以版本为后缀命名
- 接口开发 **应该** 遵循`RESTful`架构的规则, 即路由即资源, 如对投放素材的操作设计时, 路由应该设计为:

    - GET 资源的获取, 对应路由设计为
        -   `/api/material/:id => 获取单个素材的详情`
        -   `/api/material/:id/item => 获取指定素材的所有商品`
        -   `/api/material/:id/item/:id => 获取指定素材的指定商品`
        -   `/api/material => 获取素材的列表`
    - POST 资源的创建 , 对应路由设计为 `/api/material => 创建素材`
    - DELETE 资源的移除 , 对应路由设计为 `/api/material/:id => 移除素材`
    - PUT 资源的更新 , 对应路由设计为 `/api/material/:id => 更新素材`
    - 资源路由 **不应该** 超过两级嵌套， 如 `/api/material/:mId/item/:itemId/image/:imgId`，超过两级 **应该** 重新定义资源路由
        - `/api/material/item/image/:imgId?material_id=xx&item_id=xxx`

- 公用请求参数 **必须** 按照以下传入:

    -   page: 页码
    -   page_size: 分页的尺寸, 每页返回的数量
    -   order_by: 根据某一个字段排序
    -   sort: 排序的方式 asc - 升序, desc - 逆序

- 对于敏感数据, **绝不** 在接口中返回, 接口返回 **应该** 适量适当, 按需返回

- 对象节点的返回, **应该** 要有默认值

    ```json
    # 如下示例 在店铺关联管理员的时候, 如果能关联到管理员 返回对象
    {
        "shop_id": 1,
        "owner_id": 2,
        "owner_info": {
            "name": "张三"
        }
    }
    ```

    ```json
    # 在店铺关联管理员的时候, 如果关联的管理员发生异常或无法读取, 不应该返回 null 应该返回空对象(模型关联时增加默认值的返回)
    {
        "shop_id": 1,
        "owner_id": 2,
        "owner_info": {
        }
    }
    ```

- 接口响应的基本格式 **必须** 按照下列格式返回:

    ```json
    {
        "code": 10000,
        "message": "success",
        "data": []
    }
    ```

- 分页的响应基本格式, **必须** 按照下列格式返回:

    ```json
    {
        "code": 10000,
        "message": "success",
        "data": [
            {},
            {}
        ],
        "page":1,
        "page_size":20,
        "total":100
    }
    ```


### 错误码的约定

由于历史的原因, 接口的响应码有两种标准:

-   多平台项目中 `code => 10000` 标识接口正常响应
-   电商项目中 `code => 0` 标识接口正常响应

除此之外, 错误的接口响应码格式 **必须** 为 整型, **应该** 定长四位, 命名的标准 **可以** 参考如下:

- 响应码的具体意义 **应该** 如下：

    - 第一位：标识错误的来源 标识业务场景
    - 第二位：标识错误的等级及致命程度 0-9 致命程度递增
    - 第三位：同第四位 错误的随机码
    - 第四位：同第三位 错误的随机码

- 第一位错误标识的定义 **应该** 如下:

    - AUTH（authorization 授权、权限、权益相关）对应响应码开头为：1
    - VAL（validation 值验证, 表单验证） 对应响应码开头为：2
    - SYS（system 系统内部, 逻辑处理异常的错误类型）对应响应码开头为：3
    - NET（http 网络请求, 白名单、限流相关的错误类型）对应响应码开头为：4
    - CUS  (custom 自定义的错误类型) 对应响应码开头为 5
    - IDS（inner dependency service 内部服务调用报错, 如rpc、跨模块、应用间调用报错）对应响应码开头为：6
    - THR（third party 依赖第三方, 除去企业内部模块或应用的依赖第三方的请求错误）对应响应码开头为：7
    - DB（database 数据库执行的错误码）对应响应码开头为：8
    - CON (contract缩写 和前端的契约响应码  前端会根据此类响应码做特殊交互) 对应开头 9

### 接口文档的维护

  接口文档 **应该** 使用yapi维护, 并保持更新, 后续 **可以** 改用 ApiDoc 或 Swagger

  >   [Yapi 文档中心](https://yapi.gaoding.com/)

### Http状态码使用约定

接口响应码 *应该* 使用以下推荐值

- 200 请求成功
- 201 POST数据创建成功的响应码
- 202 需要异步处理的， 不能立刻返回结果的响应码
- 204 DELETE 或 PUT方法操作成功的响应码
- 301 请求资源被永久重定向
- 302 请求资源被临时重定向
- 400 请求的语法错误，服务器无法正确处理
- 401 权限校验失败，特指过期，失效
- 403 权限不足， 特指越权操作，或未经授权的操作
- 404 资源不存在
- 405 错误的请求方法
- 406 不支持的数据格式， 用户预期的返回格式无法支持
- 429 请求达到并发限制
- 500 服务器错误
- 502 网关超时
- 503 服务器维护中
-
完整的http 状态码的标准 *可以* 参照  [Http](https://baike.baidu.com/item/HTTP/243074?fr=aladdin) , 且约定如下:



